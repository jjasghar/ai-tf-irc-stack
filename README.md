# IRC Stack Terraform Deployment

[![Multi-Cloud Support](https://img.shields.io/badge/Multi--Cloud-DigitalOcean%20%7C%20IBM%20Cloud-blue?style=flat-square)](#cloud-providers)
[![Terraform](https://img.shields.io/badge/Terraform-1.0%2B-623CE4?logo=terraform&style=flat-square)](https://terraform.io)
[![Ansible](https://img.shields.io/badge/Ansible-Automation-red?logo=ansible&style=flat-square)](#ansible-automation)
[![License: Apache 2.0](https://img.shields.io/badge/License-Apache%202.0-blue.svg?style=flat-square)](LICENSE)

This Terraform configuration deploys a complete IRC stack with **multi-cloud support** and **fully automated Ansible provisioning**:

- **🚀 Ergo IRC Server** - Modern IRC server written in Go (v2.14.0)
- **💬 The Lounge** - Modern web IRC client with persistent connections
- **🔒 Caddy** - Reverse proxy with automatic HTTPS and Let's Encrypt integration
- **🌐 DNSimple** - DNS management with A/CNAME record automation
- **⚙️ Ansible Automation** - Complete OS-specific provisioning and configuration

### ☁️ **Cloud Providers Supported:**
- **🌊 DigitalOcean** - Droplets, Firewalls, SSH Keys
- **☁️ IBM Cloud** - Virtual Server Instances, VPC, Security Groups

## Architecture

```
Internet
    ↓
[DNSimple DNS] → [Cloud Instance: DigitalOcean or IBM Cloud]
                      ↓
                 [Caddy :80/:443] 
                      ↓
                 [The Lounge :9000] ← → [Ergo IRC :6667/:6697]
```

### Cloud-Specific Architecture

**DigitalOcean:**
- Droplet (Virtual Machine)
- DigitalOcean Firewall
- SSH Key Management

**IBM Cloud:**
- Virtual Server Instance (VSI)
- VPC with Subnet
- Security Groups
- Floating IP

## Project Structure

```
ai-tf-irc-stack/
├── ansible/                   # 🤖 Ansible automation
│   ├── playbooks/            # OS-specific deployment playbooks
│   │   ├── site.yml         # Main orchestration playbook
│   │   ├── fedora.yml       # Fedora-specific tasks (DigitalOcean)
│   │   └── debian.yml       # Debian-specific tasks (IBM Cloud)
│   ├── inventory/            # Dynamic inventory generated by Terraform
│   │   └── hosts            # Auto-generated host configuration
│   ├── requirements.yml     # Ansible collection dependencies
│   ├── roles/               # Custom Ansible roles (for future expansion)
│   └── templates/           # Jinja2 templates (for future expansion)
├── configs/                  # 📝 Configuration templates
│   ├── Caddyfile.fedora     # Caddy config optimized for Fedora
│   ├── Caddyfile.debian     # Caddy config optimized for Debian
│   ├── Caddyfile            # Generic Caddy config (reference)
│   ├── ergo-ircd.yaml       # Ergo IRC server configuration
│   ├── ergo-motd.txt        # IRC server Message of the Day
│   ├── thelounge-config.js  # The Lounge web client config
│   ├── ergo.service         # Ergo systemd service definition
│   └── thelounge.service    # The Lounge systemd service definition
├── scripts/                  # 🔧 Automation and helper scripts
│   ├── setup-ansible.sh     # Ansible environment setup
│   ├── test-ansible-idempotency.sh  # Deployment reliability testing
│   ├── update-ergo-certs.sh # SSL certificate management
│   ├── install-fedora.sh    # Fedora installation script (legacy)
│   ├── install-debian.sh    # Debian installation script (legacy)
│   ├── install.sh           # Generic installation script (legacy)
│   └── substitute_config.sh # Template variable substitution (legacy)
├── main.tf                   # 🏗️ Main Terraform configuration
├── variables.tf              # 📊 Variable definitions
├── outputs.tf                # 📤 Output definitions
└── terraform.tfvars.example # 📋 Example configuration
```

## Prerequisites

### For All Deployments:
1. **DNSimple Account** with API token and domain management
2. **SSH Key Pair** for server access  
3. **Terraform** installed (>= 1.0)
4. **Ansible** installed (>= 2.9) - See [Ansible Setup](#ansible-automation)

### For DigitalOcean:
5. **DigitalOcean Account** with API token
6. **SSH Key** uploaded to DigitalOcean

### For IBM Cloud:
5. **IBM Cloud Account** with API key
6. **SSH Key** created in IBM Cloud console
7. **Resource Group** (default or custom)

## Quick Start

1. **Clone and setup:**
   ```bash
   git clone <this-repo>
   cd ai-tf-irc-stack
   ```

2. **Setup Ansible environment:**
   ```bash
   ./scripts/setup-ansible.sh
   ```

3. **Configure variables:**
   ```bash
   cp terraform.tfvars.example terraform.tfvars
   # Edit terraform.tfvars with your tokens and settings
   ```

4. **Deploy:**
   ```bash
   terraform init
   terraform plan
   terraform apply
   ```

5. **Verify deployment (optional):**
   ```bash
   ./scripts/test-ansible-idempotency.sh
   ```

6. **Access your IRC server:**
   - Web interface: `https://irc-testing.asgharlabs.io`
   - IRC SSL: `irc-testing.asgharlabs.io:6697`
   - IRC Plain: `irc-testing.asgharlabs.io:6667`

## Cloud Providers

This deployment supports both **DigitalOcean** and **IBM Cloud**. Choose your preferred provider by setting the `cloud_provider` variable.

### 🌊 DigitalOcean Configuration

**Required variables:**
```hcl
cloud_provider = "digitalocean"
do_token = "your_digitalocean_api_token_here"
```

**Resources created:**
- Droplet (Virtual Machine) - `s-2vcpu-4gb` (2 vCPU, 4GB RAM)
- Firewall with IRC and web ports open
- Uses existing SSH key by ID

**Setup steps:**
1. Get API token from [DigitalOcean API](https://cloud.digitalocean.com/account/api/tokens)
2. Upload your SSH key to DigitalOcean
3. Update the SSH key ID in `main.tf` (line 50)

### ☁️ IBM Cloud Configuration

**Required variables:**
```hcl
cloud_provider = "ibm"
ibm_api_key = "your_ibm_api_key_here"
ibm_ssh_key_name = "your_ssh_key_name"
```

**Optional variables:**
```hcl
ibm_region = "us-south"              # Default region
ibm_resource_group = "default"        # Default resource group
```

**Resources created:**
- Virtual Server Instance (VSI) - `bx2-2x8` (2 vCPU, 8GB RAM)
- VPC with subnet and security group
- Floating IP for public access
- Security group rules for IRC and web ports

**Setup steps:**
1. Get API key from [IBM Cloud API Keys](https://cloud.ibm.com/iam/apikeys)
2. Create SSH key in [IBM Cloud Console](https://cloud.ibm.com/vpc-ext/compute/sshKeys)
3. Note your resource group name (default: "default")

### 🔄 Switching Cloud Providers

To switch between providers:

1. **Update `terraform.tfvars`:**
   ```hcl
   # For DigitalOcean
   cloud_provider = "digitalocean"
   
   # For IBM Cloud  
   cloud_provider = "ibm"
   ```

2. **Run Terraform:**
   ```bash
   terraform plan    # Review changes
   terraform apply   # Deploy to new provider
   ```

> **Note:** The infrastructure is conditionally created based on `cloud_provider`. Only resources for the selected provider will be created.

## Ansible Automation

This project uses **Ansible** for complete automated provisioning and configuration management, replacing traditional shell scripts with reliable, idempotent automation.

### 🚀 **Key Features:**

- **OS-Specific Automation**: Dedicated playbooks for Fedora (DigitalOcean) and Debian (IBM Cloud)
- **Idempotent Deployments**: Run multiple times safely with consistent results
- **Automatic SSL Management**: Advanced certificate sharing between Caddy and Ergo
- **Non-blocking SSL Setup**: Production-ready immediately with background certificate acquisition
- **Service Monitoring**: Built-in health checks and status reporting
- **Zero Manual Intervention**: Complete hands-off deployment experience

### 📋 **Ansible Setup:**

1. **Install Ansible** (if not already installed):
   ```bash
   # macOS
   brew install ansible
   
   # Ubuntu/Debian
   sudo apt update && sudo apt install ansible
   
   # RHEL/CentOS/Fedora
   sudo dnf install ansible
   
   # Python pip
   pip install ansible
   ```

2. **Setup project dependencies:**
   ```bash
   ./scripts/setup-ansible.sh
   ```

### 🔄 **OS-Specific Deployment:**

| Cloud Provider | Operating System | Ansible Playbook | Package Manager | Firewall |
|---|---|---|---|---|
| **DigitalOcean** | Fedora 41 | `fedora.yml` | `dnf` | `firewalld` |
| **IBM Cloud** | Debian 12 | `debian.yml` | `apt` | `ufw` |

### 🧪 **Testing & Validation:**

**Test deployment idempotency:**
```bash
./scripts/test-ansible-idempotency.sh
```

**Manual Ansible commands:**
```bash
# Test connectivity
ansible all -i ansible/inventory/hosts -m ping

# Run playbook manually
ansible-playbook -i ansible/inventory/hosts ansible/playbooks/site.yml

# Check mode (dry run)
ansible-playbook -i ansible/inventory/hosts ansible/playbooks/site.yml --check --diff
```

### 🔒 **Advanced SSL Certificate Management:**

The project includes sophisticated SSL certificate automation:

- **Automatic Let's Encrypt acquisition** via Caddy
- **Certificate sharing** between Caddy and Ergo IRC server
- **Systemd integration** with path watchers and auto-restart
- **Fallback self-signed certificates** for immediate operation
- **Automatic retry mechanisms** with 5-minute intervals
- **Zero-downtime updates** with background processing

**Certificate update process:**
```bash
# Automatic update (handled by systemd)
systemctl status ergo-cert-update.path

# Manual certificate update
/usr/local/bin/update-ergo-certs.sh your-hostname.com
```

## Configuration

### Required Variables

#### For All Deployments:
| Variable | Description | Example |
|----------|-------------|---------|
| `cloud_provider` | Cloud provider to use | `"digitalocean"` or `"ibm"` |
| `dnsimple_token` | DNSimple API token | `your_token` |
| `dnsimple_account_id` | DNSimple account ID | `12345` |

#### For DigitalOcean Only:
| Variable | Description | Example |
|----------|-------------|---------|
| `do_token` | DigitalOcean API token | `dop_v1_...` |

#### For IBM Cloud Only:
| Variable | Description | Example |
|----------|-------------|---------|
| `ibm_api_key` | IBM Cloud API key | `your_api_key` |
| `ibm_ssh_key_name` | SSH key name in IBM Cloud | `my-ssh-key` |

### Optional Variables

| Variable | Default | Description |
|----------|---------|-------------|
| `ssh_public_key_path` | `~/.ssh/id_rsa.pub` | SSH public key path |
| `project_name` | `irc-stack` | Project name for resources |
| `region` | `nyc3` | DigitalOcean region |
| `hostname` | `irc-testing.asgharlabs.io` | Server hostname |
| `dns_zone` | `asgharlabs.io` | DNS zone |
| `dns_record_name` | `irc-testing` | DNS record name |
| `admin_email` | `admin@asgharlabs.io` | Admin email |
| `ergo_network_name` | `AsgharlabsNet` | IRC network name |
| `debug_mode` | `true` | Enable debug mode with random hostname suffix |

## Debug Mode vs Production Mode

This project supports two operational modes controlled by the `debug_mode` variable:

### 🐛 **Debug Mode** (`debug_mode = true`)
- **Hostname**: `irc-abc123.asgharlabs.io` (with random 6-character suffix)
- **Purpose**: Testing and development deployments
- **Benefits**: 
  - Unique hostnames for each deployment
  - No DNS conflicts when testing multiple versions
  - Safe to deploy repeatedly without cleanup
- **Use case**: Development, testing, CI/CD pipelines

### 🚀 **Production Mode** (`debug_mode = false`)
- **Hostname**: `irc.asgharlabs.io` (clean, no suffix)
- **Purpose**: Production deployments
- **Benefits**:
  - Clean, memorable URLs
  - Professional appearance
  - SEO-friendly hostnames
- **Use case**: Live production IRC servers

### Examples

**Debug Mode Configuration:**
```hcl
# terraform.tfvars
debug_mode = true
dns_record_name = "irc"
# Results in: irc-abc123.asgharlabs.io
```

**Production Mode Configuration:**
```hcl
# terraform.tfvars
debug_mode = false
dns_record_name = "irc"  
# Results in: irc.asgharlabs.io
```

> **⚠️ Important:** CNAME records (`www` subdomain) are only created in production mode (`debug_mode = false`)

## 🆕 What's New & Enhanced Features

This project has undergone significant improvements to provide enterprise-grade automation and reliability:

### 🚀 **Major Updates & New Features:**

#### **Complete Ansible Automation (v2.0)**
- **Replaced legacy shell scripts** with robust Ansible playbooks
- **OS-specific automation** for Fedora (DigitalOcean) and Debian (IBM Cloud)
- **Idempotent deployments** - run multiple times safely
- **Template validation** with automatic error detection
- **Zero-intervention deployments** from start to finish

#### **Advanced SSL Certificate Management**
- **Automatic certificate sharing** between Caddy and Ergo IRC server
- **Non-blocking SSL setup** - production ready immediately
- **Systemd integration** with path watchers and auto-restart
- **Automatic retry mechanisms** every 5 minutes until successful
- **Fallback self-signed certificates** for immediate operation
- **Zero-downtime certificate updates**

#### **Enhanced Multi-Cloud Support**
- **Conditional resource creation** based on cloud provider selection
- **Cloud-specific optimizations** for both DigitalOcean and IBM Cloud
- **Dynamic inventory generation** by Terraform for Ansible
- **Provider-specific configurations** and firewall management

#### **Production-Ready Monitoring & Debugging**
- **Comprehensive service monitoring scripts** (`/root/check_services.sh`)
- **Automated health checks** for all IRC stack components
- **Advanced troubleshooting commands** and debugging workflows
- **Real-time log monitoring** with structured output
- **Network connectivity validation** and port status checking

#### **Quality Assurance & Testing**
- **Idempotency testing script** (`test-ansible-idempotency.sh`)
- **Ansible syntax validation** and deployment verification
- **Configuration template validation** with substitution checking
- **Automated setup scripts** for development environment

#### **Enhanced Security & Reliability**
- **Firewall automation** (firewalld for Fedora, ufw for Debian)
- **Service dependency management** with proper startup ordering
- **Automatic service restart policies** with exponential backoff
- **User and permission management** for all services
- **Secure certificate file permissions** and ownership

### 🔧 **Infrastructure Improvements:**

- **Ergo IRC Server**: Updated to v2.14.0 with enhanced features
- **Enhanced MOTD support**: Customizable Message of the Day with template variables
- **OS-specific configurations**: Optimized Caddyfiles for each operating system
- **Dynamic hostname generation**: Improved debug mode with random suffixes
- **Resource tagging**: Consistent tagging across all cloud resources
- **Improved networking**: Better security group and firewall configurations

### 📊 **Developer Experience Enhancements:**

- **Setup automation**: One-command Ansible environment setup
- **Comprehensive documentation**: Detailed troubleshooting and customization guides
- **Multiple deployment methods**: Terraform, Ansible, and hybrid approaches
- **Configuration management**: Template-based configuration with validation
- **Real-time debugging**: Enhanced logging and monitoring capabilities

### 🔄 **Migration from Legacy Scripts:**

The project has **completely migrated** from shell-based user_data scripts to Ansible automation:

| Legacy Approach | New Ansible Approach |
|---|---|
| Single `user_data.sh` script | OS-specific Ansible playbooks |
| Manual error handling | Automatic retry and validation |
| No idempotency guarantees | Fully idempotent deployments |
| Basic configuration | Template-based configuration management |
| Manual certificate setup | Automated SSL certificate management |
| Limited debugging | Comprehensive monitoring and debugging |

## Getting API Tokens

### DigitalOcean Token
1. Go to [DigitalOcean API](https://cloud.digitalocean.com/account/api/tokens)
2. Click "Generate New Token"
3. Give it a name and select "Write" scope
4. Copy the token (starts with `dop_v1_`)

### DNSimple Token
1. Go to [DNSimple Account Settings](https://dnsimple.com/user)
2. Navigate to "Automation" tab
3. Generate a new token
4. Copy the token

### DNSimple Account ID
Find this in your DNSimple dashboard URL: `https://dnsimple.com/a/{ACCOUNT_ID}/domains`

## Post-Deployment Setup

### The Lounge Admin User

After deployment, create an admin user for The Lounge:

```bash
# SSH to your server
ssh root@$(terraform output -raw droplet_ip)

# Create admin user
sudo -u thelounge thelounge --home /home/thelounge/.thelounge add admin

# Set password for admin user
sudo -u thelounge thelounge --home /home/thelounge/.thelounge reset admin
```

### IRC Server Admin

The IRC server comes with a default admin user:
- **Username:** `admin`
- **Password:** `admin123` (change this!)

To change the admin password:
1. Generate a new password hash: `/opt/ergo/ergo genpasswd`
2. Update the password in `/opt/ergo/ircd.yaml`
3. Restart Ergo: `systemctl restart ergo`

## Service Management & Monitoring

### 🔍 **Comprehensive Service Monitoring:**

The deployment includes an automated service check script for complete system monitoring:

```bash
ssh root@$(terraform output -raw server_ip)
/root/check_services.sh
```

**Output includes:**
- Complete service status for all IRC stack components
- Network port status and bindings
- Recent service logs for troubleshooting
- SSL certificate status and validity

### 🛠️ **Individual Service Control:**

```bash
# Ergo IRC Server
systemctl status ergo
systemctl restart ergo
systemctl reload ergo

# The Lounge Web Client
systemctl status thelounge  
systemctl restart thelounge

# Caddy Reverse Proxy
systemctl status caddy
systemctl restart caddy
systemctl reload caddy  # Reload config without restart

# SSL Certificate Management
systemctl status ergo-cert-update.path  # Certificate watcher
systemctl status caddy-cert-retry.timer # SSL retry timer
```

### 📊 **Advanced Monitoring Commands:**

```bash
# Check all IRC stack services at once
systemctl status ergo thelounge caddy

# Monitor logs in real-time
journalctl -u ergo -u thelounge -u caddy -f

# Check network connectivity
ss -tlnp | grep -E ":(80|443|6667|6697)"

# Validate SSL certificates
openssl s_client -connect your-hostname.com:6697 -servername your-hostname.com

# Test web interface
curl -I https://your-hostname.com
```

### 🔄 **Ansible Re-deployment:**

To apply configuration changes or re-run deployment:

```bash
# Re-run Ansible playbook
ansible-playbook -i ansible/inventory/hosts ansible/playbooks/site.yml

# Check what would change (dry run)
ansible-playbook -i ansible/inventory/hosts ansible/playbooks/site.yml --check --diff

# Run specific tasks by tag
ansible-playbook -i ansible/inventory/hosts ansible/playbooks/site.yml --tags "ssl,certificates"
```

## Firewall Configuration

The server automatically configures these ports:
- **22** - SSH
- **80** - HTTP (redirects to HTTPS)
- **443** - HTTPS (The Lounge web interface)
- **6667** - IRC plain text
- **6697** - IRC SSL

## File Locations

| Service | Config Location | Logs |
|---------|----------------|------|
| Ergo | `/opt/ergo/ircd.yaml` | `/opt/ergo/ircd.log` |
| The Lounge | `/home/thelounge/.thelounge/config.js` | `journalctl -u thelounge` |
| Caddy | `/etc/caddy/Caddyfile` | `/var/log/caddy/access.log` |

## Troubleshooting

### 🚨 **Services Not Starting**

**Check service status:**
```bash
# Use the automated service check script
/root/check_services.sh

# Individual service status
systemctl status ergo thelounge caddy --no-pager -l
```

**Check logs:**
```bash
# All IRC stack services
journalctl -u ergo -u thelounge -u caddy -f

# Individual service logs
journalctl -u ergo -f --no-pager
journalctl -u thelounge -f --no-pager  
journalctl -u caddy -f --no-pager
```

**Validate configurations:**
```bash
# Ergo IRC server configuration
/opt/ergo/ergo run --check

# Caddy configuration
caddy validate --config /etc/caddy/Caddyfile

# Check Ansible configuration substitutions
grep -E '\{.*\}' /opt/ergo/ergo-ircd.yaml /etc/caddy/Caddyfile
```

### 🌐 **DNS Not Resolving**

```bash
# Check DNS propagation
dig your-hostname.com
nslookup your-hostname.com

# Check DNSimple records via API
curl -H "Authorization: Bearer $DNSIMPLE_TOKEN" \
     "https://api.dnsimple.com/v2/$DNSIMPLE_ACCOUNT_ID/zones/your-domain.com/records"

# Verify Terraform DNS outputs
terraform output dns_record_fqdn
```

### 🔒 **SSL Certificate Issues**

The project includes advanced SSL automation. If certificates aren't working:

**Check automatic SSL systems:**
```bash
# Check certificate retry timer
systemctl status caddy-cert-retry.timer
systemctl status caddy-cert-retry.service

# Check certificate watcher
systemctl status ergo-cert-update.path
systemctl status ergo-cert-update.service

# Manual certificate acquisition
systemctl restart caddy
sleep 30
/usr/local/bin/update-ergo-certs.sh your-hostname.com
```

**Certificate troubleshooting:**
```bash
# Check Caddy certificate storage
ls -la /var/lib/caddy/.local/share/caddy/certificates/acme-v02.api.letsencrypt.org-directory/

# Check Ergo certificate directory
ls -la /opt/ergo/certs/

# Validate certificate files
openssl x509 -in /opt/ergo/certs/server.crt -text -noout

# Force certificate renewal
caddy reload --config /etc/caddy/Caddyfile
```

### 🤖 **Ansible Deployment Issues**

**Test Ansible connectivity:**
```bash
# Test SSH connectivity
ansible all -i ansible/inventory/hosts -m ping

# Check inventory file
cat ansible/inventory/hosts

# Validate playbook syntax
ansible-playbook ansible/playbooks/site.yml --syntax-check
```

**Re-run deployment:**
```bash
# Full re-deployment
ansible-playbook -i ansible/inventory/hosts ansible/playbooks/site.yml

# Verbose mode for debugging
ansible-playbook -i ansible/inventory/hosts ansible/playbooks/site.yml -vvv

# Run specific OS playbook
ansible-playbook -i ansible/inventory/hosts ansible/playbooks/fedora.yml  # For DigitalOcean
ansible-playbook -i ansible/inventory/hosts ansible/playbooks/debian.yml  # For IBM Cloud
```

### 🔧 **Configuration Issues**

**Check template substitutions:**
```bash
# Verify all templates were processed correctly
ansible-playbook -i ansible/inventory/hosts ansible/playbooks/site.yml --check --diff

# Manual configuration verification
ssh root@$(terraform output -raw server_ip)
grep -r "HOSTNAME_PLACEHOLDER\|{hostname}\|{ergo_network}" /opt/ergo/ /etc/caddy/
```

## Customization

### 📝 **Configuration Management with Ansible**

All service configurations are stored in the `configs/` directory as templates and managed by Ansible for reliable, idempotent deployments:

**OS-Specific Configurations:**
- **`configs/Caddyfile.fedora`** - Optimized for Fedora (DigitalOcean)
- **`configs/Caddyfile.debian`** - Optimized for Debian (IBM Cloud)
- **`configs/ergo-ircd.yaml`** - IRC server configuration
- **`configs/ergo-motd.txt`** - IRC server Message of the Day
- **`configs/thelounge-config.js`** - Web client configuration
- **`configs/ergo.service`** - IRC server systemd service
- **`configs/thelounge.service`** - Web client systemd service

### 🔧 **Template Variables**

The configuration files support automatic variable substitution:

| Variable | Description | Example |
|----------|-------------|---------|
| `{hostname}` | Full server hostname | `irc-testing.asgharlabs.io` |
| `{ergo_network}` | IRC network name | `AsgharlabsNet` |
| `{ergo_motd}` | Message of the day | `Welcome to Asgharlabs IRC Network!` |

Variables are automatically substituted during Ansible deployment with validation to ensure all placeholders are replaced.

### 🚀 **Applying Configuration Changes**

**Method 1: Ansible Re-deployment (Recommended)**
```bash
# Edit configs locally, then re-run Ansible
ansible-playbook -i ansible/inventory/hosts ansible/playbooks/site.yml

# Check what would change first
ansible-playbook -i ansible/inventory/hosts ansible/playbooks/site.yml --check --diff

# Apply only configuration changes
ansible-playbook -i ansible/inventory/hosts ansible/playbooks/site.yml --tags "config"
```

**Method 2: Full Terraform Re-deployment**
```bash
# Replace infrastructure to pick up config changes
terraform apply -replace="digitalocean_droplet.irc_server"  # DigitalOcean
terraform apply -replace="null_resource.ibm_provisioning"   # IBM Cloud
```

**Method 3: Manual Copy and Apply**
```bash
# Copy updated configs using Ansible
ansible all -i ansible/inventory/hosts -m copy -a 'src=configs dest=/tmp'

# Apply specific configuration changes
ssh root@$(terraform output -raw server_ip)
ansible-playbook -i ansible/inventory/hosts ansible/playbooks/site.yml --tags "caddy,ergo,thelounge"
```

### 🎛️ **Direct Server Configuration**

For immediate testing or emergency changes, you can edit configurations directly:

```bash
# IRC Server configuration
ssh root@$(terraform output -raw server_ip)
vim /opt/ergo/ergo-ircd.yaml
systemctl restart ergo

# Web Client configuration
vim /var/lib/thelounge/.thelounge/config.js
systemctl restart thelounge

# Reverse Proxy configuration  
vim /etc/caddy/Caddyfile
caddy validate --config /etc/caddy/Caddyfile  # Validate first
systemctl reload caddy
```

⚠️ **Note:** Direct server changes will be overwritten on next Ansible deployment. Always update local configuration files for permanent changes.

## Cleanup

To destroy all resources:
```bash
terraform destroy
```

## Security Notes

1. **Change default passwords** immediately after deployment
2. **Restrict SSH access** to your IP if possible
3. **Enable fail2ban** for additional SSH protection
4. **Regularly update** the system: `dnf update -y`
5. **Monitor logs** for suspicious activity

## Support

- [Ergo Documentation](https://ergo.chat/guide.html)
- [The Lounge Documentation](https://thelounge.chat/docs)
- [Caddy Documentation](https://caddyserver.com/docs/)
- [Terraform DigitalOcean Provider](https://registry.terraform.io/providers/digitalocean/digitalocean/latest/docs)
- [Terraform DNSimple Provider](https://registry.terraform.io/providers/dnsimple/dnsimple/latest/docs)